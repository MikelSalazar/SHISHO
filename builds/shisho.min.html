<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>SHISHO SHISHO Template</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<style> html, body { width:100%; height:100%; margin:0; } </style>
		<script>
// SHISHO

class SHISHO{constructor(e={}){this._viewports=[];let t=this._instanceNumber=SHISHO.instances.length;let i=this._instanceString="ShishoApp"+(t>0?t:"");SHISHO.instances.push(this);this._data=new Root;this._viewports.push(new Viewport(this,e));if(e.dataElement){this._dataElement=document.getElementById(e.dataElement)}else this._dataElement=document.getElementById(i+"Data");if(e.data){if(typeof e.data==="string"){this._dataElement=document.getElementById(e.dataElement);if(!this._dataElement)throw new Error("Invalid data element")}this.deserialize(e.data)}console.log(SHISHO.AppName+" "+SHISHO.AppVersion+" Initialized")}static get AppName(){return"SHISHO"}static get AppVersion(){return"0.4.1"}static get _instanceNumber(){return this._instanceNumber}get viewports(){return this._viewports}get data(){return this._data}static init(e){return new SHISHO(e)}deserialize(e){try{if(typeof e=="string"){let t=e.indexOf("{"),i=e.lastIndexOf("}");if(t<0||i<0)throw new Error("Invalid JSON data");let s=e.slice(t,i+1);e=JSON.parse(s)}this._data.deserialize(e)}catch(e){return false}}serialize(){let e="";if(this._saveToElement){if(!this._dataElement){this._dataElement=document.createElement("script");this._dataElement.id=this._instanceString+"Data";document.body.append(this._dataElement)}this._dataElement.textContent="\nlet "+this._instanceString+"Data = "+e+";\n"}return e}}SHISHO.instances=[];SHISHO.resources={};class JsonExporter{static export(e){let t=e.serialize();let i=new Blob([t],{type:"text/plain;charset=utf-8"});let s=window.URL.createObjectURL(i);let n=document.createElement("a");document.body.appendChild(n);n.style.display="none";n.href=s;n.download="file.json";n.click();setTimeout((function(){document.body.removeChild(n);window.URL.revokeObjectURL(s)}),0);return t}}class JsonSchemaExporter{static export(e){let t={$id:"https://example.com/example.schema.json",$schema:"http://json-schema.org/draft-07/schema#",properties:{}};for(let i in e.classes){let s=e.classes[i];let n=t.properties[s.name.value]={};n.type="object";n.description=s.description}let i=JSON.stringify(t,null,"  ");let s=new Blob([i],{type:"text/plain;charset=utf-8"});let n=window.URL.createObjectURL(s);let r=document.createElement("a");document.body.appendChild(r);r.style.display="none";r.href=n;r.download="schema.json";r.click();setTimeout((function(){document.body.removeChild(r);window.URL.revokeObjectURL(n)}),0);return i}}class OwlExporter{static export(e){let t="";for(let t in e.classes){let i=e.classes[t]}return t}}class SqlExporter{static export(e){let t="";for(let t in e.classes){let i=e.classes[t]}return t}}class JsonImporter{static import(e,t,i=true){let s=JSON.parse(t);e.deserialize(s,"combine")}}class OwlImporter{static import(e,t,i=true){let s=new DOMParser;let n=s.parseFromString(t,"text/xml");let r=null;for(let e of n.getRootNode().children)if(e.nodeName=="rdf:RDF")r=e;if(!r)throw new Error("Invalid OWL File. ");let l=e.ontology;if(!i)l.deserialize();for(let e of r.children){switch(e.nodeName){case"owl:Ontology":let t,i=this.getName(e);break;case"owl:Class":let s,n=this.getName(e);if(n)s=new Class("className",l,{name:n});else throw Error("Class name not defined");let r=this.findElement("entityPositionX",e);let o=this.findElement("entityPositionY",e);s.positions=[new Vector("position",s,{x:r?parseFloat(r.textContent):0,y:o?parseFloat(o.textContent):0})];console.log("Created Class: "+s.name+": "+JSON.stringify(s.positions));l.classes[n]=s;break;case"owl:ObjectProperty":let a,h=null;for(let t of e.attributes){if(t.name.toLowerCase()=="rdf:id")h=t.textContent;if(t.name.toLowerCase()=="rdf:about")h=t.textContent.split("#")[1]}let d=this.findElement("domain",e);let u=this.findElement("range",e);let c=this.extractName(d.attributes[0]);let _=this.extractName(u.attributes[0]);a=new Relation(h,l,{name:h,origin:c,target:_});l.relations[h]=a;console.log("Relation:"+h);break}}Object.keys(l.relations).forEach((e=>{let t=l.relations[e];if(!l.classes[t.origin.value])throw Error("Class not defined: '"+t.origin+"' in relation '"+e+"'");if(!l.classes[t.target.value])throw Error("Class not defined: '"+t.target+"' in relation '"+e+"'")}))}static getName(e){let t,i=null;for(let i of e.attributes){switch(i.name.toLowerCase()){case"rdf:id":return i.textContent;case"rdf:about":t=this.extractName(i);break}}return t}static extractName(e){return e.textContent.split("#")[1]}static findElement(e,t){let i=[t];while(i.length>0){let t=i.pop();if(t.nodeName.includes(e))return t;i.push(...t.children)}return null}}class Node{constructor(e,t,i,s){this.isNode=true;this._nodeType=e||"node";this._nodeName=t;this._nodeParent=i;this._nodeChildren=[];if(i)i._nodeChildren.push(this);this._nodeUpdated=true;this.nodeUpdated=false}get nodeName(){return this._nodeName}get nodeType(){return this._nodeType}get nodeParent(){return this._nodeParent}get nodeChildren(){return this._nodeChildren}get nodeUpdated(){return this._nodeUpdated}set nodeUpdated(e){if(this._nodeUpdated==e)return;if(e)for(let e in this._nodeChildren)this._nodeChildren[e].nodeUpdated=false;else if(this._nodeParent)this._nodeParent.nodeUpdated=false;this._nodeUpdated=e}update(e=0,t=false){if(this._nodeUpdated&&!t)return;if(Node.onPreUpdate)Node.onPreUpdate(this);for(let i of this._nodeChildren)i.update(e,t);if(Node.onPostUpdate)Node.onPostUpdate(this);this._nodeUpdated=true}serialize(e){let t={};for(let i of this._nodeChildren)if(i.nodeName)t[i.nodeName]=i.serialize(e);return t}deserialize(e={},t){if(typeof e=="string")JSON.parse(e);if(Array.isArray(e)){for(let i=0;i<e.length;i++){if(i>=this.nodeChildren.length)return;this.nodeChildren[i].deserialize(e[i],t)}}else for(let i in e){if(e[i]==undefined)continue;for(let s of this._nodeChildren){if(s._nodeName==i){s.deserialize(e[i],t);break}}}}}class Class extends Node{constructor(e,t,i){super("class",e,t,i);this._name=new String("name",this);this._description=new String("description",this);this._properties=new NodeSet("properties",this,Property);this._positions=new NodeSet("positions",this,Vector);if(i)this.deserialize(i)}get name(){return this._name}get description(){return this._description}get properties(){return this._properties}get positions(){return this._positions}}class Ontology extends Node{constructor(e,t,i){super("ontology",e,t,i);this._classes=new NodeSet("classes",this,Class);this._relations=new NodeSet("relations",this,Relation);if(i)this.deserialize(i)}get classes(){return this._classes}get relations(){return this._relations}}class Property extends Node{constructor(e,t,i){super("property",e,t,i);this._name=new String("name",this);this._description=new String("description",this);if(i)this.deserialize(i)}get name(){return this._name}get description(){return this._description}}class Relation extends Node{constructor(e,t,i){super("relation",e,t,i);this._name=new String("name",this);this._description=new String("description",this);this._origin=new String("origin",this);this._target=new String("target",this);this._midpoint=new Vector("midpoint",this);if(i)this.deserialize(i)}get name(){return this._name}get description(){return this._description}get origin(){return this._origin}get target(){return this._target}get midpoint(){return this._midpoint}}class Root extends Node{constructor(e){super("root",null,e);this._name=new String("name",this);this._description=new String("description",this);this._author=new String("author",this);this._ontology=new Ontology("ontology",this);this._styles=new NodeSet("styles",this,Style);if(e)this.deserialize(e)}get name(){return this._name}get description(){return this._description}get author(){return this._author}get ontology(){return this._ontology}get styles(){return this._styles}}class Style extends Node{constructor(e,t,i){super("style",e,t,i);this._name=new String("name",this);this._nodeParent=new String("parent",this);this._shape=new String("shape",this);this._width=new Size("width",this);this._height=new Size("height",this);this._radius=new Size("radius",this);this._radius2=new Size("radius2",this);this._color=new Color("color",this);this._borderColor=new Color("border_color",this);this._borderWidth=new Size("border_width",this);this._textFont=new String("text_font",this);this._textSize=new Size("text_size",this);this._textAlign=new String("text_align",this);this._textColor=new Color("text_color",this);this._icon=new String("icon",this);this._iconColor=new Color("icon_color",this);this._iconSize=new Size("icon_size",this);this._iconOffsetX=new Distance("icon_offset_x",this);this._iconOffsetY=new Distance("icon_offset_y",this);if(i!=undefined)this.deserialize(i)}get name(){return this._name}get parent(){return this._parent}get shape(){return this._shape}get width(){return this._width}get height(){return this._height}get radius(){return this._radius}get radius2(){return this._radius2}get color(){return this._color}set color(e){this._color=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get borderWidth(){return this._borderWidth}get textFont(){return this._textFont}get textSize(){return this._textSize}get textAlign(){return this._textAlign}get textColor(){return this._textColor}get icon(){return this._icon}get iconColor(){return this._iconColor}get iconSize(){return this._iconSize}get iconOffsetX(){return this._iconOffsetX}get iconOffsetY(){return this._iconOffsetY}getValue(e){let t=this[e],i=this._nodeParent;return t}static combine(e){if(!e||e.length==0)throw Error("No styles to combine");if(e.length==1)return e[0];let t=new Style("style",null);for(let i=0;i<e.length;i++){let s=e[i];let n=s.serialize();t.deserialize(n)}return t}}class NodeSet extends Node{constructor(e,t,i,s){super("nodeset",e,t,s);this._nodeSubtype=i}get typedChildren(){return this.nodeChildren}serialize(e){let t=[];for(let i in this._nodeChildren)t.push(this._nodeChildren[i].serialize(e));return t}deserialize(e,t){if(Array.isArray(e)){for(const t of e)new this._nodeSubtype(t.name,this,t)}else for(const t in e){let i=new this._nodeSubtype(t,this,e[t]);this[t]=i}}get(e){return this[e]}getIndex(e){return this.nodeChildren[e]}[Symbol.iterator](){let e=0;let t=this._nodeChildren;return{next(){if(e<t.length)return{done:false,value:t[e++]};else return{done:true,value:null}}}}}class Color extends Node{constructor(e,t,i){super("color",e,t,i);this._r=new Number("r",this);this._g=new Number("g",this);this._b=new Number("b",this);if(i!=undefined)this.deserialize(i)}get r(){return this._r}get g(){return this._g}get b(){return this._b}set(e=0,t=0,i=0){this._r.value=e;this._g.value=t;this._b.value=i}toString(){return"rgb("+this._r.value+", "+this._g.value+", "+this._b.value+")"}}class Euler extends Node{constructor(e,t,i){super("euler",e,t,i);this._x=new Angle("x",this,0);this._y=new Angle("y",this,0);this._z=new Angle("z",this,0);if(i)this.deserialize(i)}get x(){return this._x}get y(){return this._y}get z(){return this._z}}class Quaternion extends Node{constructor(e,t,i){super("distance",e,t,i);this._x=new Measure("x","x",this,0);this._y=new Measure("y","y",this,0);this._z=new Measure("z","z",this,0);this._w=new Measure("w","w",this,1);if(i)this.deserialize(i)}get x(){return this._x}get y(){return this._y}get z(){return this._z}get w(){return this._w}}class Vector extends Node{constructor(e,t,i){super("vector",e,t,i);this._x=new Measure("x","x",this);this._y=new Measure("y","y",this);this._z=new Measure("z","z",this);if(i)this.deserialize(i)}get x(){return this._x}get y(){return this._y}get z(){return this._z}toArray(){return[this._x.get()||this.x.default,this._y.get()||this.y.default,this._z.get()||this.z.default]}fromArray(e){this._x.value=e.length>0?e[0]:0;this._y.value=e.length>1?e[1]:0;this._z.value=e.length>2?e[2]:0}set(e,t,i){this._x.value=e;this._y.value=t;this._z.value=i}}class Measure extends Node{constructor(e,t,i,s){super(e||"measure",t,i,s);this._value=undefined;this._min=Number.NEGATIVE_INFINITY;this._max=Number.POSITIVE_INFINITY;this._default=0;this._unit=undefined;if(s)this.deserialize(s)}get value(){return this._value}set value(e){if(this._value!=e)this.nodeUpdated=false;if(e==undefined)e=this._default;if(e<this._min)this._value=this._min;else if(e>this._max)this._value=this._max;else this._value=e;this.nodeUpdated=false}get min(){return this._min}set min(e){if(e>this._max)this._max=e;if(this._value&&e>this._value)this.value=e;this._min=e;this.nodeUpdated=false}get max(){return this._max}set max(e){if(e<this._min)this._min=e;if(this._value&&this._value)this.value=e;this._max=e;this.nodeUpdated=false}get default(){return this._default}set default(e){this._default=e;this.nodeUpdated=false}get unit(){return this._unit}set unit(e){this._unit=e;this.nodeUpdated=false}serialize(){return this._value}deserialize(e,t){if(typeof e!=="number")e=parseFloat(e);this.value=e}get(){return this.value}}class Angle extends Measure{constructor(e,t,i){super("angle",e,t,i);if(i)this.deserialize(i);if(this.unit)this.unit="degrees"}}class Distance extends Measure{constructor(e,t,i){super("distance",e,t,i);if(i)this.deserialize(i);if(this.unit)this.unit="meters"}}class Size extends Measure{constructor(e,t,i){super("size",e,t,i);if(i)this.deserialize(i);if(this.unit)this.unit="meters"}}class Time extends Measure{constructor(e,t,i){super("time",e,t,i);if(i)this.deserialize(i);if(this.unit)this.unit="seconds"}}class Number extends Node{constructor(e,t,i){super("number",e,t,i);this._value=undefined;this._default=undefined;if(i)this.deserialize(i)}get value(){return this._value}set value(e){if(this._value!=e)this.nodeUpdated=false;this._value=e}get default(){return this._default}set default(e){this._default=e}serialize(){return this._value}deserialize(e,t){if(e==undefined)this.value=undefined;else if(typeof e!=="number")this.value=parseFloat(e);else this.value=e}}class String extends Node{constructor(e,t,i){super("string",e,t,i);this._value=undefined;this._default=undefined;if(i)this.deserialize(i)}get value(){return this._value}set value(e){if(this._value!=e)this.nodeUpdated=false;this._value=e}get default(){return this._default}set default(e){this._default=e}serialize(){return this._value}deserialize(e,t){if(typeof e!=="string")e=JSON.stringify(e);this.value=e}}class Element{constructor(e,t,i=null,s=null,n=null){this._visibility=1;this._name=e;this._position=t||new Vector("position");this._styles=i||[];this._text=s;this._icon=n}get name(){return this._name}get position(){return this._position}get styles(){return this._styles}get shape(){return this._shape}get text(){return this._text}get icon(){return this._icon}get visibility(){return this._visibility}draw(e){let t=Style.combine(this._styles);let i=this._position;e.save();let s=[],n=0,r=0;if(this._text&&t.textFont){e.font=t.textSize.get()+" "+t.textFont.value;let i=this._text.split("\n"),l=i.length,o=t.textSize.get(),a=o*.5;r=o*l;for(let t=0;t<l;t++){let l=i[t];let a=e.measureText(l);if(n<a.width)n=a.width;s.push(new Shape({text:l,x:0,y:o*t-r/2+o/2}))}}if(!this._shape){switch(t.shape.value){case"circle":this._shape=new Circle({x:0,y:0,radius:t.radius.get(),color:t.color.toString(),borderColor:t.borderColor.toString(),borderWidth:t.borderWidth.get()});break}}if(!this._shape)return;this._shape.draw(e,i);if(this._icon){if(t.iconColor)e.fillStyle=t.iconColor.toString();if(t.iconOffsetX)e.translate(t.iconOffsetX.get(),0);if(t.iconOffsetY)e.translate(0,t.iconOffsetY.get());if(SHISHO.resources[this._icon]){SHISHO.resources[this._icon].draw(e,i,t.iconSize.get())}else throw Error("Unknown Icon: "+this._icon)}for(const n of s){if(t.textColor)e.fillStyle=t.textColor.toString();e.textAlign="center";e.textBaseline="middle";n.draw(e,i)}e.restore()}isInside(e,t){return false}}class Widget{constructor(e,t,i){this._children=[];this._visibility=1;this._removeIfHidden=false;this._updated=false;this._name=e;this._parent=t;this._element=i;if(t){this.parent.children.push(this);if(i&&t.element&&i.parentElement!=t.element){t.element.appendChild(i)}}}get name(){return this._name}get element(){return this._element}get parent(){return this._parent}set parent(e){this._parent=e;let t=this.element;if(t&&t.parentElement)t.parentElement.removeChild(t);if(t&&this._parent.element)this._parent.element.appendChild(t)}get children(){return this._children}get visibility(){return this._visibility}set visibility(e){this._visibility=e;this.updated=false}get updated(){return this._updated}set updated(e){if(this._updated==e)return;if(e)this._children.forEach((e=>{e._updated=true}));else if(this._parent)this._parent._updated=false;this._updated=e}update(e,t=false){if(this._updated&&!t)return;let i=this._element,s=this._parent;if(this._removeIfHidden&&this._visibility<=0){if(i&&this._element.parentElement)i.parentElement.removeChild(i);if(this._parent){const e=s.children.indexOf(this);if(e>=0)s._children.splice(e,1)}return}if(i&&this._visibility!=1){i.style.opacity=""+this._visibility}if(this._visibility<=0)return;for(const i of this._children)i.update(e,t);this.updated=true}show(){this.visibility=1}hide(){this.visibility=0}handleEvent(e){let t=0,i=this._children.length;for(t=i-1;t>=0;t--)if(this._children[t].handleEvent(e))return true;return false}}class Layer extends Widget{constructor(e,t,i){super(e,null,createElement(i,t.element,t.element.id+e,null,"ShishoLayer"));this._name=e;this._viewport=t}get viewport(){return this._viewport}}class DebugLayer extends Layer{constructor(e){super("Debug",e,"div");this._FPSValue=0;this._FPSLabel=new Label("FPS",this,"FPS: 0");this._FPSLabel.element.className="ShishoDebugFPSLabel"}update(e){if(this._FPSValue!=this.viewport.FPS){this._FPSValue=this.viewport.FPS;this._FPSLabel.text="FPS: "+this._FPSValue}}}class DialogLayer extends Layer{constructor(e){super("Dialog",e,"div")}}class MainLayer extends Layer{constructor(e){super("Main",e,"div");this._graph=new Graph("Graph",this)}get name(){return this._name}}class MenuLayer extends Layer{constructor(e){super("Menu",e,"canvas");this._elements=[];this._canvas=this._element;this._context=this._canvas.getContext("2d");let t=new Style("test",null,{name:"test",shape:"circle",color:[0,128,255],radius:128,icon_color:[255,255,255],icon_size:160});this._elements.push(new Element("a",new Vector("p",null,{x:0,y:0}),[t,new Style(null,null,{icon_offset_x:32,icon_offset_y:32})],null,"App"));this._elements.push(new Element("b",new Vector("p",null,{x:0,y:0}),[t,new Style(null,null,{icon_offset_x:-32,icon_offset_y:32})],null,"Options"));this._elements.push(new Element("c",new Vector("p",null,{x:0,y:0}),[t,new Style(null,null,{icon_offset_x:32,icon_offset_y:-32})],null,"Test"));this._elements.push(new Element("d",new Vector("p",null,{x:0,y:0}),[t]))}get canvas(){return this._canvas}get elements(){return this._elements}update(e,t=false){let i=this._canvas,s=this._context;let n=i.width=this._viewport.width,r=i.height=this._viewport.height;s.clearRect(0,0,n,r);this._elements[0].position.set(64,64);this._elements[1].position.set(n-64,64);this._elements[2].position.set(64,r-64);this._elements[3].position.set(n-64,r-64);let l,o=this._elements.length;for(l=0;l<o;l++){this._elements[l].draw(s)}super.update(e)}}class Shape{constructor(e={}){this._x=e.x||0;this._y=e.y||0;this._width=e.width||0;this._height=e.height||0;this._path=new Path2D(e.path);this._text=e.text;this._font=e.font;this._color=e.color;this._borderColor=e.borderColor;this._borderWidth=e.borderWidth;this._children=[];if(e.children)e.children.forEach((e=>{this._children.push(e)}))}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}get path(){return this._path}get color(){return this._color}get borderColor(){return this._borderColor}get borderWidth(){return this._borderWidth}get children(){return this._children}draw(e,t=null,i=null){e.save();e.translate(this._x,this.y);if(t)e.translate(t.x.get(),t.y.get());if(i){let t=this._width>this._height?this._width:this._height,s=i/t;if(this._width&&this._height)e.translate(-this.width*s/2,-this._height*s/2);e.scale(s,s)}if(this._path){e.fillStyle=this._color;e.fill(this._path);if(this._borderColor&&this._borderWidth){e.lineWidth=this._borderWidth;e.strokeStyle=this._borderColor;e.stroke(this._path)}}if(this._text){e.fillStyle=this._color;e.fillText(this._text,0,0)}this._children.forEach((t=>{t.draw(e)}));e.restore()}}class Circle extends Shape{constructor(e={}){super(e);this._radius=e.radius||0;this.update()}get radius(){return this._radius}update(){this._path=new Path2D;this._path.arc(this._x,this._y,this._radius,0,2*Math.PI)}}class Rectangle extends Shape{constructor(e={}){super(e);this._radius=e.radius||0}get radius(){return this._radius}}class Viewport{constructor(e,t={}){this._layers={};this._updateTime=0;this._deltaTime=0;this._FPSTimeCounter=0;this._FPSFrameCounter=0;this._FPS=0;this._forcedUpdates=false;this._app=e;this._parentElement=t.parentElement||document.body;let i=SHISHO.instances.length;if(i==1){createCssRule(".ShishoViewport","position: relative;"+"width: 100%; height: 100%; margin:0; overflow: hidden;");createCssRule(".ShishoLayer","position: absolute;"+"width: 100%; height: 100%; margin:0; overflow: hidden;");createCssRule(".ShishoBackground","position: absolute;"+"width: 100%; height: 100%; margin:0; overflow: hidden;"+"background: #00000080; ");createCssRule(".ShishoWindow","position: relative;"+"top: 50%; left: 50%; transform: translate(-50%,-50%); "+"box-sizing: border-box; background: white; color: black;"+"border: 2px solid blue; border-radius: 2vmin;"+"font-family: Arial, Helvetica, sans-serif; font-size: 2vmin;"+"width: max-content; height:max-content; box-sizing: border-box;");createCssRule(".ShishoWindowTitle","width:100%; box-sizing: border-box;"+"background: blue; color: white; border-radius: 2vmin;"+"font-size: 3vmin; text-align: center; padding: 1vmin;");createCssRule(".ShishoWindowContents","min-width:10vmin; min-height:10vmin; padding: 1vmin;"+"text-align: center;");createCssRule(".ShishoWindowContents label ","font-weight:bold");createCssRule(".ShishoWindowContents input, .ShishoWindowContents select","font-family: Arial, Helvetica, sans-serif; font-size: 2vmin;");createCssRule(".ShishoWindowButtonGroup","display:flex; justify-content: space-evenly;");createCssRule(".ShishoWindowButton","width:max-content; height:max-content; margin: 1vmin;"+"background: blue; color: white; border-radius: 2vmin;"+"font-size: 3vmin; text-align: center; padding: 1vmin;");createCssRule(".ShishoDebugFPSLabel","font-family: Arial, Helvetica, sans-serif; font-size: 2vmin; color: red")}this._element=createElement("div",this._parentElement,"ShishoViewport"+i,null,"ShishoViewport");let s=this._layers.main=new MainLayer(this);let n=this._layers.menu=new MenuLayer(this);let r=this.layers.dialog=new DialogLayer(this);let l=this.layers.debug=new DebugLayer(this);document.addEventListener("keyup",(e=>{if(e.ctrlKey&&e.code=="KeyI"){if(this.layers.dialog.children.length==0)Dialog.create("Import",this.layers.dialog)}if(e.ctrlKey&&e.code=="KeyE"){if(this.layers.dialog.children.length==0)Dialog.create("Export",this.layers.dialog)}e.preventDefault()}));function o(e){e.preventDefault();if(this._layers.dialog.handleEvent(e))return;if(this._layers.menu.handleEvent(e))return;if(this._layers.main.handleEvent(e))return}document.addEventListener("wheel",o.bind(this));document.addEventListener("pointerdown",o.bind(this));document.addEventListener("pointermove",o.bind(this));document.addEventListener("pointerup",o.bind(this));document.addEventListener("touchdown",o.bind(this));document.addEventListener("touchmove",o.bind(this));document.addEventListener("touchup",o.bind(this));document.addEventListener("click",o.bind(this));document.addEventListener("dblclick",o.bind(this));document.addEventListener("contextmenu",o.bind(this));requestAnimationFrame(this.update.bind(this))}get app(){return this._app}get layers(){return this._layers}get parentElement(){return this._parentElement}get element(){return this._element}get width(){return this._element.clientWidth}get height(){return this._element.clientHeight}get updateTime(){return this._updateTime}get deltaTime(){return this._deltaTime}get FPS(){return this._FPS}update(e=0){let t=e>0?e/1e3:.001;this._deltaTime=t-this._updateTime;this._updateTime=t;if(this._deltaTime>.1)this._deltaTime=.1;this._FPSTimeCounter+=this._deltaTime;this._FPSFrameCounter++;if(this._FPSTimeCounter>1){this._FPSTimeCounter-=1;this._FPS=this._FPSFrameCounter;this._FPSFrameCounter=0}for(const e in this._layers){this._layers[e].update(this._deltaTime,this._forcedUpdates)}requestAnimationFrame(this.update.bind(this))}}function createElement(e,t,i=null,s=null,n=null,r=null,l=null){if(!e)throw Error("Tag required");let o=document.createElement(e);if(t)t.appendChild(o);if(i)o.id=i;if(s)o.id=s;if(n)o.className=n;if(r)o.style.cssText=r;if(l)o.innerText=l;return o}function createCssRule(e,t,i=false){if(document.styleSheets.length==0)document.head.append(document.createElement("style"));let s=document.styleSheets[0];let n=e+" {"+t+"}";let r=s.cssRules,l,o=r.length;for(l=0;l<o;l++){if(r[l].cssText.indexOf(e)==0&&r[l].cssText[e.length]==" "){if(i)r[l].cssText=n;return}}s.insertRule(e+" {"+t+"}",o)}class Background extends Widget{constructor(e,t){super(e,t,createElement("div",t.element,t.element+"Background",null,"ShishoBackground"));this._removeIfHidden=true}}class Button extends Widget{constructor(e,t,i,s=[]){super(e,t);this._text=i;this._callbacks=s;let n=t&&t.element?t.element:null;this._element=createElement("div",n,e,null,"ShishoWindowButton",null,this._text);this._element.addEventListener("click",(e=>{for(let e of this._callbacks)if(e(this)==false)return}))}get text(){return this._text}get callbacks(){return this._callbacks}}class Dialog extends Widget{constructor(e,t,i,s,n,r){super(e,t);this._removeIfHidden=true;this._title=i;this._contents=s;this._buttons=n;this._background=r;let l=t&&t.element?t.element:null;if(this.background)l=r.element;this._element=createElement("div",l,e,null,"ShishoWindow");this._titleGroup=new Widget("TitleGroup",this,createElement("div",this._element,e+i,null,"ShishoWindowTitle",null,this._title));this._contentsGroup=new Widget("ContentsGroup",this,createElement("div",this._element,e+i,null,"ShishoWindowContents"));for(let e of this._contents)e.parent=this._contentsGroup;this._buttonGroup=new Widget("ButtonGroup",this,createElement("div",this._element,e+"Buttons",null,"ShishoWindowButtonGroup"));for(let e of this._buttons){e.parent=this._buttonGroup;e.callbacks.push((()=>{this.hide();if(this._background)this._background.hide()}))}}get background(){return this._background}get title(){return this._title}get contents(){return this._contents}get buttons(){return this._buttons}update(e){super.update(e)}static create(e,t,i=null,s=null){let n=t.viewport.app.data;switch(e){case"Import":return new Dialog("Import",t,"Import File...",[new FileInput("FileInput",null,"File: "),new Selector("FileType",null,"File Type: ",["JSON","OWL"])],[new Button("Cancel",null,"Cancel"),new Button("Import",null,"Import",[e=>{let i=e.parent.parent;let s=i.contents[0];let r=i.contents[1];console.log(s.filePath);try{if(s.filePath==null)throw Error("No file provided.");let e=s.fileData;switch(r.selectedOption){case"JSON":JsonImporter.import(n,e);break;case"OWL":OwlImporter.import(n,e);break}}catch(e){console.error(e);Dialog.create("Error",t,"Error","Unable to import File.<br>"+e.message);return false}}])],new Background("ImportBackground",t));case"Export":return new Dialog("Export",t,"Export File...",[new Selector("FileType",null,"File Type: ",["JSON","OWL","SCHEMA.JSON","SQL"])],[new Button("Cancel",null,"Cancel"),new Button("Export",null,"Export",[e=>{let i=e.parent.parent;let s=i.contents[0];let n=t.viewport.app.data.ontology;let r="";switch(s.selectedOption){case"JSON":r=JsonExporter.export(n);break;case"OWL":r=OwlExporter.export(n);break;case"SCHEMA.JSON":r=JsonSchemaExporter.export(n);break;case"SQL":r=SqlExporter.export(n);break}console.log(r)}])],new Background("ImportBackground",t));case"Info":return new Dialog("Info",t,i,[new Text("ErrorMessage",null,s)],[new Button("OK",null,"OK")],new Background("ErrorBackground",t));case"Error":return new Dialog("Error",t,i,[new Text("ErrorMessage",null,s)],[new Button("OK",null,"OK")],new Background("ErrorBackground",t))}}}class FileInput extends Widget{constructor(e,t,i){super(e,t);this._label=i;let s=t&&t.element?t.element:null;this._element=createElement("p",s,e);this._labelElement=createElement("label",this._element,e+"Label",null,null,null,i);this._inputElement=createElement("input",this._element,e+"Input");this._inputElement.type="file";this._inputElement.onchange=e=>{let t=e.target.files[0];this._fileName=t.name;this._filePath=t.path;let i=new FileReader;i.readAsText(t,"UTF-8");i.onload=e=>{this._fileData=e.target.result.toString()}}}get fileName(){return this._fileName}get filePath(){return this._filePath}get fileData(){return this._fileData}}class Graph extends Widget{constructor(e,t){super(e,t,createElement("canvas",t.element,t.name+"Canvas"));this._x=0;this._y=0;this._zoom=1;this._zoomLevel=0;this._elements={};this._canvas=this._element;this._context=this._canvas.getContext("2d");this._basicStyle=new Style(null,null,{name:"simple",shape:"circle",radius:"50",color:[255,255,255],border_width:"2",border_color:[0,0,255],text_color:[0,0,0],text_font:"Arial",text_size:"16px"})}get x(){return this._x}set x(e){this._x=e;this.updated=false}get y(){return this._y}set y(e){this._y=e;this.updated=false}get zoom(){return this._zoom}set zoom(e){this._zoom=e;this.updated=false}get zoomLevel(){return this._zoomLevel}set zoomLevel(e){this._zoomLevel=e;this.updated=false}get elements(){return this._elements}update(e,t){if(this._updated&&!t)return;let i=this._canvas,s=this._context;let n=i.width=this.parent.element.clientWidth,r=i.height=this.parent.element.clientHeight;s.clearRect(0,0,n,r);s.fillStyle="white";s.fillRect(0,0,n,r);s.translate(n/2,r/2);s.scale(this._zoom,this._zoom);s.translate(this._x,this._y);s.strokeStyle="red";let l=10;s.strokeRect(-l/2,l/2,l,l);let o=this.parent.viewport.app.data.ontology;if(!o)return;s.fillStyle="black";s.font="16px Arial";s.textAlign="center";s.textBaseline="middle";for(const e of o.relations.typedChildren){let t=o.classes.get(e.origin.value);let i=o.classes.get(e.target.value);let n=t.positions.getIndex(0);let r=i.positions.getIndex(0);let l=n.x.get(),a=n.y.get();let h=r.x.get(),d=r.y.get();s.beginPath();s.moveTo(l,a);let u,c;if(e.midpoint.x.get()!=undefined){let t=e.midpoint;let i=this.fitCircleToPoints(l,a,t.x,t.y,h,d);let n=Math.atan2(a-i.y,l-i.x);let r=Math.atan2(d-i.y,h-i.x);s.arc(i.x,i.y,i.radius,n,r,i.CCW);u=t.x;c=t.y}else{u=(l+h)/2;c=(a+d)/2;s.lineTo(h,d)}s.strokeStyle="lightgrey";s.stroke();s.fillStyle="black";s.textAlign="center";s.textBaseline="middle";s.font="Arial 12px";s.fillText(e.name.value,u,c)}this._elements={};for(const e of o.classes){let t=e.name.value;let i=new Element(t,e.positions.getIndex(0),[this._basicStyle],t);this._elements[t]=i;i.draw(s)}for(const e of o.relations){let t=o.classes.get(e.origin.value);let i=o.classes.get(e.target.value);let n=t.positions.getIndex(0);let r=i.positions.getIndex(0);if(e.midpoint.x.get()!=undefined){n=e.midpoint}let l=this._elements[t.name.value];let a=0;if(l.shape.radius)a=l.shape.radius;let h=this.calculateArrow(n,r,a,16);s.beginPath();s.fillStyle="lightgrey";s.moveTo(h[0].x.get(),h[0].y.get());s.lineTo(h[1].x.get(),h[1].y.get());s.lineTo(h[2].x.get(),h[2].y.get());s.fill()}super.update(e,t)}handleEvent(e){switch(e.type){case"pointermove":let t=e;if(t.buttons==1||t.buttons==2){this._x+=t.movementX/this._zoom;this._y+=t.movementY/this._zoom;this.updated=false}break;case"wheel":let i=e;let s=this._canvas,n=s.width,r=s.height,l=i.clientX-n/2,o=i.clientY-r/2,a=this._zoom;this._zoomLevel+=i.deltaY<0?1:-1;this._zoom=Math.pow(1.5,this._zoomLevel);console.log("Zoom: "+(this._zoom*100).toFixed(0)+"%");this._x+=-l/a+l/this._zoom;this._y+=-o/a+o/this._zoom;this.updated=false;break;case"touchmove":let h=e;console.log("touchmove");break;case"dblclick":break;default:return false}return true}fitCircleToPoints(e,t,i,s,n,r){var l,o,a;const h=(i-e)/(t-s);const d=(n-i)/(s-r);if(h===d){return}if(t===s){l=(e+i)/2;o=d*l+((s+r)/2-d*((i+n)/2))}else if(s===r){l=(i+n)/2;o=h*l+((t+s)/2-h*((e+i)/2))}else{l=((s+r)/2-d*((i+n)/2)-(a=(t+s)/2-h*((e+i)/2)))/(h-d);o=h*l+a}return{x:l,y:o,radius:Math.pow(Math.pow(e-l,2)+Math.pow(t-o,2),.5),CCW:(n-e)*(s-t)-(r-t)*(i-e)>=0}}calculateArrow(e,t,i,s){let n=e.x.get()-t.x.get(),r=e.y.get()-t.y.get();let l=Math.sqrt(n*n+r*r);n/=l;r/=l;let o=r,a=-n;let h=t.x.get()+n*i;let d=t.y.get()+r*i;let u=h+n*s;let c=d+r*s;let _=s/2;return[new Vector(null,null,[h,d]),new Vector(null,null,[u+o*_,c+a*_]),new Vector(null,null,[u-o*_,c-a*_])]}}class Label extends Widget{constructor(e,t,i){super(e,t,createElement("label",null));this.text=i}get text(){return this._text}set text(e){this._element.innerHTML=this._text=e}}class Selector extends Widget{constructor(e,t,i,s){super(e,t);this._label=i||"";this._options=s||[];let n=t&&t.element?t.element:null;this._element=createElement("p",n,e);this._labelElement=createElement("label",this._element,e+"Label",null,null,null,i);this._selectElement=createElement("select",this._element,e+"Label",null,null,null,i);let r=0,l=this._options.length;for(r=0;r<l;r++){let e=createElement("option",this._selectElement,null,null,null,null,this._options[r]);e.value=""+r}}get selectedOption(){return this._options[this.selectedIndex]}get selectedIndex(){return parseInt(this._selectElement.value)}}class Text extends Widget{constructor(e,t,i){super(e,t,createElement("p",null));this.text=i}get text(){return this._text}set text(e){this._element.innerHTML=this._text=e}}SHISHO.resources={App:new Shape({width:512,height:512,children:[new Shape({color:"#4facfe",path:"m 271.83223,123.93778 -88.90151,161.1114 7.69932,4.25201 88.9015,-161.1114 z m 17.22091,12.33414 -3.53519,8.05479 108.39002,47.62755 3.53519,-8.04697 z m 108.01308,57.60033 a 4.3966097,4.3966097 0 0 0 -0.13266,0.002 4.3966097,4.3966097 0 0 0 -4.08209,3.18949 l -19.97485,69.9208 a 4.3966097,4.3966097 0 0 0 3.01957,5.43366 4.3966097,4.3966097 0 0 0 5.43365,-3.01957 l 19.9827,-69.92275 a 4.3966097,4.3966097 0 0 0 -3.02741,-5.43171 4.3966097,4.3966097 0 0 0 -1.21876,-0.17189 z m -25.90071,90.50505 c -2.84772,0 -5.15632,2.41459 -5.15632,5.3946 0,2.98 2.3086,5.39654 5.15632,5.39654 2.8477,0 5.15631,-2.41654 5.15631,-5.39654 0,-2.98001 -2.30861,-5.3946 -5.15631,-5.3946 z m -192.09422,8.22666 a 4.3966097,4.3966097 0 0 0 -3.98833,2.58011 4.3966097,4.3966097 0 0 0 2.18558,5.82429 l 75.1865,34.15668 a 4.3966097,4.3966097 0 0 0 5.82428,-2.18557 4.3966097,4.3966097 0 0 0 -2.18557,-5.8243 l -75.1865,-34.15667 a 4.3966097,4.3966097 0 0 0 -1.66017,-0.39063 4.3966097,4.3966097 0 0 0 -0.17578,-0.004 z m 187.00431,12.66032 a 4.3966097,4.3966097 0 0 0 -0.13085,0.004 4.3966097,4.3966097 0 0 0 -4.08208,3.18168 l -16.80099,58.71948 -61.40312,-27.03548 a 4.3966097,4.3966097 0 0 0 -1.66213,-0.37698 4.3966097,4.3966097 0 0 0 -4.13286,2.627 4.3966097,4.3966097 0 0 0 2.25003,5.79499 l 62.50664,27.52381 -0.76368,2.66993 a 4.3966097,4.3966097 0 0 0 3.01957,5.4317 4.3966097,4.3966097 0 0 0 5.43366,-3.01954 l 0.43164,-1.50782 3.15629,1.39062 a 4.3966097,4.3966097 0 0 0 5.795,-2.25199 4.3966097,4.3966097 0 0 0 -2.25198,-5.79499 l -4.25787,-1.87501 17.13108,-59.87382 a 4.3966097,4.3966097 0 0 0 -3.01762,-5.44148 4.3966097,4.3966097 0 0 0 -1.22071,-0.166 z"}),new Shape({color:"#ffffff",path:"m 132.51993,103.88675 -6.04695,11.44154 -12.44548,1.26956 8.53138,9.57824 -2.72661,12.76774 11.33803,-5.50788 10.77163,6.6114 -1.51174,-12.96695 9.36731,-8.67394 -12.28337,-2.5137 z m 129.47234,0.14064 -4.29108,23.84405 -21.19168,9.8302 20.35378,11.63882 2.37503,24.1546 16.87326,-16.66818 22.67607,5.08601 -9.93373,-21.92216 11.63492,-20.99049 -23.00029,3.07816 z m 125.61289,51.67057 -4.29301,23.8714 -21.21903,9.8302 20.35573,11.63882 2.37502,24.1253 16.87328,-16.63888 22.67605,5.086 -9.90638,-21.92215 11.63493,-21.01979 -23.0003,3.10746 z m -282.70276,33.67425 -3.18559,17.79711 -15.818559,7.31649 15.172069,8.67199 1.75393,18.02366 12.58023,-12.42984 16.926,3.7852 -7.39658,-16.35567 8.66612,-15.65059 -17.14279,2.31643 z m 62.19999,64.46566 -4.64458,25.93392 -23.08038,10.67786 22.137,12.65641 2.58988,26.24448 18.33032,-18.10766 24.64873,5.56453 -10.77161,-23.8714 12.63297,-22.82646 -24.9964,3.39068 z m 167.64469,83.13971 -4.40045,24.43784 -21.73074,10.05677 20.84011,11.92199 2.42971,24.71907 17.27757,-17.06467 23.21708,5.22662 -10.15052,-22.45925 11.90445,-21.49833 -23.54131,3.1641 z"})]}),Options:new Shape({width:512,height:512,children:[new Shape({path:"m 272.067,511.99962 h -32.13325 c -25.98923,0 -47.13461,-21.14423 -47.13461,-47.13458 v -10.87108 c -11.0491,-3.53001 -21.78413,-7.98615 -32.09697,-13.32286 l -7.70421,7.70421 c -18.6592,18.68186 -48.54817,18.13421 -66.66349,-0.008 L 63.623228,425.65766 C 45.474265,407.52874 44.952311,377.65 63.629275,358.99422 l 7.698162,-7.69816 C 65.990352,340.98322 61.535411,330.2501 58.004567,319.19912 H 47.134616 C 21.146514,319.19965 0,298.05564 0,272.06832 v -32.13399 c 0,-25.98922 21.145002,-47.13458 47.134616,-47.13458 h 10.869951 c 3.530995,-11.04985 7.986163,-21.78411 13.32287,-32.09695 l -7.703832,-7.70307 c -18.666003,-18.64595 -18.15123,-48.52923 0.006,-66.663434 l 22.71318,-22.711982 c 18.159165,-18.184099 48.041705,-18.638021 66.663485,0.006 l 7.69703,7.697024 c 10.31285,-5.335948 21.04825,-9.79202 32.09697,-13.322861 V 47.134581 C 192.80022,21.145364 213.94414,0 239.93489,0 h 32.13325 c 25.98923,0 47.13461,21.143853 47.13461,47.134581 v 10.871077 c 11.04911,3.53001 21.78413,7.986157 32.09697,13.32286 l 7.70384,-7.703826 c 18.6592,-18.681863 48.54816,-18.134209 66.66348,0.0072 l 22.71125,22.710092 c 18.14896,18.128916 18.67091,48.007656 -0.008,66.663436 l -7.69817,7.69816 c 5.33709,10.31284 9.79203,21.04596 13.32287,32.09695 h 10.86996 c 25.98923,0 47.13461,21.14423 47.13461,47.13458 v 32.13398 c 0,25.98922 -21.145,47.13458 -47.13461,47.13458 h -10.86996 c -3.53099,11.04985 -7.98616,21.78411 -13.32287,32.09695 l 7.70421,7.70382 c 18.66601,18.64596 18.15086,48.52923 -0.008,66.66344 l -22.71313,22.71198 c -18.15916,18.1841 -48.0417,18.63802 -66.66349,-0.008 l -7.69702,-7.69702 c -10.31285,5.33595 -21.04825,9.79202 -32.09697,13.32286 v 10.8715 C 319.1986,490.85615 298.05435,512 272.06398,512 Z M 165.71837,409.16981 c 14.32709,8.47296 29.74723,14.87399 45.83068,19.02505 6.62401,1.70903 11.25206,7.68304 11.25206,14.524 v 22.14807 c 0,9.44695 7.6872,17.13301 17.13415,17.13301 h 32.13326 c 9.44695,0 17.13415,-7.68606 17.13415,-17.13301 v -22.14807 c 0,-6.84096 4.62805,-12.8149 11.25207,-14.524 16.0842,-4.15106 31.50395,-10.55209 45.83067,-19.02505 5.89495,-3.48601 13.39997,-2.53803 18.24307,2.30499 l 15.68811,15.68885 c 6.76386,6.77217 17.62587,6.61494 24.22419,0.008 l 22.72712,-22.72597 c 6.58206,-6.57412 6.80203,-17.43802 0.008,-24.22493 l -15.69491,-15.69489 c -4.84197,-4.84197 -5.78988,-12.34812 -2.30499,-18.24193 8.47297,-14.32595 14.87286,-29.74607 19.02392,-45.83064 1.71002,-6.62401 7.68418,-11.25092 14.52401,-11.25092 h 22.14696 c 9.44695,0 17.13416,-7.68606 17.13416,-17.13301 v -32.13398 c 0,-9.44695 -7.68683,-17.13301 -17.13416,-17.13301 h -22.14696 c -6.84096,0 -12.81414,-4.62805 -14.52401,-11.25092 -4.15106,-16.08495 -10.55209,-31.50507 -19.02392,-45.83065 -3.48504,-5.89418 -2.53702,-13.39996 2.30499,-18.24192 l 15.68886,-15.68885 c 6.782,-6.77406 6.60512,-17.63418 0.008,-24.22493 L 404.45174,84.839449 c -6.58698,-6.596045 -17.45088,-6.789179 -24.22495,-0.006 L 364.53264,100.5283 c -4.84196,4.84309 -12.35002,5.791 -18.24307,2.30499 -14.3271,-8.472966 -29.74723,-14.873986 -45.83068,-19.025049 -6.62402,-1.708993 -11.25206,-7.683039 -11.25206,-14.523998 V 47.134279 c 0,-9.446948 -7.6872,-17.13301 -17.13416,-17.13301 h -32.13325 c -9.44695,0 -17.13415,7.686062 -17.13415,17.13301 v 22.148075 c 0,6.840958 -4.62805,12.814891 -11.25207,14.523997 -16.0842,4.151063 -31.50396,10.552084 -45.83067,19.025049 -5.89608,3.48499 -13.40111,2.53701 -18.24308,-2.30499 l -15.6881,-15.688851 c -6.76386,-6.772171 -17.62701,-6.614942 -24.22419,-0.0072 L 84.840041,107.55634 c -6.582065,6.57413 -6.802034,17.43689 -0.006,24.22493 l 15.694909,15.6949 c 4.84197,4.84196 5.78988,12.34812 2.30499,18.24193 -8.47297,14.32595 -14.872861,29.74607 -19.023927,45.83064 -1.710014,6.62401 -7.684179,11.25092 -14.524008,11.25092 H 47.134843 c -9.446955,0.001 -17.134157,7.68719 -17.134157,17.13414 v 32.13399 c 0,9.44694 7.687202,17.13301 17.134157,17.13301 H 69.2818 c 6.840964,0 12.814145,4.62804 14.524008,11.25092 4.151067,16.08494 10.552092,31.50507 19.023922,45.83064 3.485,5.89418 2.53702,13.39996 -2.30499,18.24192 l -15.688857,15.68885 c -6.782002,6.77406 -6.60512,17.63418 -0.006,24.22493 l 22.725227,22.72483 c 6.58698,6.59605 17.45089,6.78918 24.22495,0.008 L 147.47421,411.476 c 3.568,-3.56702 10.9909,-6.59416 18.24421,-2.30401 z"}),new Shape({path:"m 256.00019,367.38705 c -61.42883,0 -111.40188,-49.97301 -111.40188,-111.40179 0,-61.42878 49.97305,-111.40179 111.40188,-111.40179 61.42883,0 111.40188,49.97301 111.40188,111.40179 0,61.42878 -49.97305,111.40179 -111.40188,111.40179 z m 0,-192.80164 c -44.88579,0 -81.39991,36.51598 -81.39991,81.39985 0,44.88387 36.51601,81.39985 81.39991,81.39985 44.8839,0 81.39991,-36.51598 81.39991,-81.39985 0,-44.88387 -36.51525,-81.39985 -81.39991,-81.39985 z"})]}),Test:new Shape({width:512,height:512,path:"M 256.00001,0 335.10835,168.53994 512,195.5666 384.00002,326.75665 414.2167,512 256,424.53995 97.783292,511.99996 127.99999,326.75665 1.4633393e-6,195.56658 176.89164,168.53994 Z"})};
		</script>
	</head>
	<body>
		<script>SHISHO.init();</script>
	</body>
</html>
